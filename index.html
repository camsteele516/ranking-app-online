<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Multiplayer Ranking App</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .hidden { display: none; }
    .item { padding: 6px; margin: 4px 0; background: #f0f0f0; cursor: move; border: 1px solid #ccc; }
    .list-container { display: flex; flex-direction: column; gap: 6px; width: 250px; }
    button { margin-top: 10px; padding: 8px 16px; }
  </style>
</head>
<body>

<h2>Multiplayer Ranking</h2>

<div id="startScreen">
  <input type="text" id="gameIdInput" placeholder="Enter game ID" />
  <input type="text" id="playerName" placeholder="Your name" />
  <button onclick="joinGame()">Join Game</button>
</div>

<div id="rankingScreen" class="hidden">
  <h3>Drag to Rank:</h3>
  <div class="list-container" id="rankingList"></div>
  <button onclick="submitRanking()">Submit Ranking</button>
</div>

<div id="resultScreen" class="hidden">
  <h3>Matching Ranks:</h3>
  <pre id="resultText"></pre>
</div>

<script>
  // âœ… Replace with your own Firebase config:
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "1234567890",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let gameId, playerName;

  function joinGame() {
    gameId = document.getElementById("gameIdInput").value.trim();
    playerName = document.getElementById("playerName").value.trim();
    if (!gameId || !playerName) return alert("Enter game ID and name");

    const listRef = db.ref("games/" + gameId + "/items");

    listRef.once("value").then(snapshot => {
      let items = snapshot.val();
      if (!items) {
        // First player creates list
        items = prompt("Enter items to rank (one per line):").split("\n").map(i => i.trim()).filter(Boolean);
        listRef.set(items);
      }
      startRanking(items);
    });
  }

  function startRanking(items) {
    document.getElementById("startScreen").classList.add("hidden");
    document.getElementById("rankingScreen").classList.remove("hidden");

    const list = document.getElementById("rankingList");
    list.innerHTML = "";
    items.forEach(item => {
      const div = document.createElement("div");
      div.className = "item";
      div.draggable = true;
      div.textContent = item;
      list.appendChild(div);
    });

    enableDragSort(list);
  }

  function enableDragSort(container) {
    let dragged;

    container.addEventListener("dragstart", e => {
      if (e.target.classList.contains("item")) {
        dragged = e.target;
      }
    });

    container.addEventListener("dragover", e => {
      e.preventDefault();
      const target = e.target;
      if (target.classList.contains("item") && target !== dragged) {
        const rect = target.getBoundingClientRect();
        const offset = e.clientY - rect.top;
        target.parentNode.insertBefore(dragged, offset > rect.height / 2 ? target.nextSibling : target);
      }
    });
  }

  function submitRanking() {
    const items = Array.from(document.querySelectorAll("#rankingList .item")).map(div => div.textContent);
    db.ref(`games/${gameId}/rankings/${playerName}`).set(items);

    checkIfBothSubmitted();
  }

  function checkIfBothSubmitted() {
    const rankingsRef = db.ref(`games/${gameId}/rankings`);
    rankingsRef.once("value").then(snapshot => {
      const all = snapshot.val();
      if (all && Object.keys(all).length === 2) {
        const [player1, player2] = Object.keys(all);
        const [list1, list2] = [all[player1], all[player2]];
        showResults(list1, list2);
      } else {
        alert("Waiting for other player to submit...");
      }
    });
  }

  function showResults(list1, list2) {
    document.getElementById("rankingScreen").classList.add("hidden");
    document.getElementById("resultScreen").classList.remove("hidden");

    const results = list1.filter((item, index) => list2[index] === item)
                         .map((item, i) => `- ${item} (Rank ${i + 1})`);

    document.getElementById("resultText").textContent = results.length
      ? results.join("\n")
      : "No matching ranks.";
  }
</script>

</body>
</html>
